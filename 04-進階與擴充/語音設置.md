# 🎤 Clawdbot 本地語音轉文字（Whisper）完整安裝教學

> 適用對象：**已經安裝完成 Clawdbot 的使用者（macOS）**  
> 本教學將帶你完成：  
> - 安裝本地 Whisper（不用 API、不用雲端、不用付費）  
> - 整合 Clawdbot  
> - 在 Telegram 直接傳語音，自動回傳逐字稿  

---

# ✅ 完成後你可以做到什麼？

- 在 Telegram 傳語音給 Bot
- Bot 會自動：
  - 儲存檔案
  - 轉成 WAV
  - 用本機 Whisper 辨識
  - 回傳文字結果
- 全程：
  - ❌ 不用 API
  - ❌ 不用上雲
  - ❌ 不用花錢
  - ✅ 完全在你自己的電腦跑

---

# 🧱 系統需求

- macOS
- 已安裝完成：
  - Homebrew
  - Clawdbot
- Terminal 可執行：
```bash
clawdbot
```

---

# 🛠 Step 1：安裝基礎工具

## 1.1 安裝 Homebrew（如果你沒有）

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

---

## 1.2 安裝 ffmpeg（用來轉音檔）

```bash
brew install ffmpeg
```

確認：

```bash
ffmpeg -version
```

---

# 🚀 Step 2：安裝 C++ 版 Whisper（推薦）

> 這是 **最快、最穩、最省事** 的方案

## 2.1 安裝 whisper-cpp

```bash
brew install whisper-cpp
```

確認：

```bash
ls /usr/local/bin | grep whisper
```

應該會看到：

```
whisper-cli
```

---

## 2.2 下載模型

```bash
mkdir -p ~/whisper-models
cd ~/whisper-models
curl -L -o ggml-tiny.bin https://huggingface.co/ggerganov/whisper.cpp/resolve/main/ggml-tiny.bin
```

---

## 2.3 測試 whisper-cli

準備一個 wav 檔後測試：

```bash
whisper-cli -m ~/whisper-models/ggml-tiny.bin -f test.wav -l zh
```

如果有輸出文字，代表成功。

---

# 🐍 Step 3（可選）：安裝 Python 版 Whisper

> 只有在某些工具一定要用 `whisper` 指令時才需要

## 3.1 安裝 pipx

```bash
brew install pipx
pipx ensurepath
```

⚠️ 請關閉 Terminal 再重開一次

---

## 3.2 安裝 openai-whisper

```bash
pipx install openai-whisper
```

測試：

```bash
whisper --help
```

---

# 🤖 Step 4：整合 Clawdbot（建立本地 Skill）

## 4.1 建立 skills 資料夾

```bash
mkdir -p ~/clawd/skills
```

---

## 4.2 建立腳本

```bash
nano ~/clawd/skills/whisper_local.sh
```

貼上：

```bash
#!/bin/bash
set -e

BIN="/usr/local/bin/whisper-cli"
MODEL="/Users/$(whoami)/whisper-models/ggml-tiny.bin"
FFMPEG="/usr/local/bin/ffmpeg"

IN="$1"

if [ ! -f "$IN" ]; then
  echo "Audio file not found: $IN"
  exit 1
fi

BASENAME="$(basename "$IN")"
TMP_WAV="/tmp/${BASENAME%.*}.wav"

EXT="${IN##*.}"
if [ "$EXT" != "wav" ] && [ "$EXT" != "WAV" ]; then
  "$FFMPEG" -y -i "$IN" -ar 16000 -ac 1 -c:a pcm_s16le "$TMP_WAV" >/dev/null 2>&1
else
  TMP_WAV="$IN"
fi

"$BIN" -m "$MODEL" -f "$TMP_WAV" -l zh -otxt

TXT="${TMP_WAV}.txt"
if [ -f "$TXT" ]; then
  cat "$TXT"
fi

if [ "$TMP_WAV" != "$IN" ]; then
  rm -f "$TMP_WAV"
fi
```

---

## 4.3 給執行權限

```bash
chmod +x ~/clawd/skills/whisper_local.sh
```

---

## 4.4 手動測試

```bash
~/clawd/skills/whisper_local.sh test.wav
```

---

# 🧪 Step 5：實際使用

現在你可以：

- 在 Telegram 傳語音給 Clawdbot
- Bot 會：
  - 存檔到：`~/.clawdbot/media/inbound/`
  - 自動呼叫 `whisper_local.sh`
  - 回傳辨識文字

---

# 🧯 常見錯誤

## ❌ failed to read audio data as wav

👉 代表音檔不是 wav  
👉 請確認：

```bash
ffmpeg -version
```

👉 並確認你使用的是最新版腳本（有自動轉檔）

---

## ❌ 找不到 whisper-cli

```bash
which whisper-cli
```

應該顯示：

```
/usr/local/bin/whisper-cli
```

---

# 🚀 進階玩法

你可以再接：

- 語音 → 自動摘要
- 語音 → 轉簡報
- 語音 → 存 Notion
- 語音 → 存資料庫

---

# 🏁 結語

你現在已經擁有一個：

- ✅ 完全本地
- ✅ 不用 API
- ✅ 不用月費
- ✅ 可擴充工作流

的專業級語音 AI 系統。
